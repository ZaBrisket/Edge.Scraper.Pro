# 2025-09-10 — PFR player fetches rate-limited (429) causing open circuits

Summary: 35 server_error events clustered around 2025-09-10T18:27Z while hitting `www.pro-football-reference.com` player pages. Many upstream 429 responses were mapped to 500 in our system, and repeated attempts tripped our circuit breaker.

- Host affected: `www.pro-football-reference.com`
- Dominant errors: 429 → mapped as 500, and "circuit … is open"
- Time window: ~18:27:00–18:28:30Z
- Impact: batches stalled; user saw fatal 500s instead of deferrals

Counts (from analyzer):
- total_events: 35
- by_host: { "www.pro-football-reference.com": 35 }
- by_status: { "500": 29, "429": 6 } (approximate)
- pattern_counts: { upstream429As500: ~20, circuitOpen: ~9 }

Illustrative log lines:
- "[500] Upstream 429"
- "[500] Circuit for www.pro-football-reference.com is open"
- "robots [429] https://www.pro-football-reference.com/robots.txt"

Reproduction notes:
- Run a burst of ≥100 player URLs without per-host throttling; observe upstream 429s.
- Current client increments circuit failures for 429; breaker opens quickly.
- Netlify `fetch-url` maps the 429 path to 500, surfacing as fatal.

Corrective actions (implemented in this PR):
- Treat 429 as non-fatal; respect Retry-After and backoff with jitter; requeue.
- Per-host token-bucket with conservative defaults for PFR.
- Circuit breaker excludes 429 from failure counts; half-open probing.
- Proper error mapping: 429 returned as 429 with `nextRetryMs`.
- Metrics emitted for rate_limit.hit, 429.deferred, retry.scheduled, circuit state.