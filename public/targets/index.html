<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>EdgeScraperPro â€” Target Lists</title>
  <link rel="stylesheet" href="/css/brutalist.css"/>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  <header class="site-header"><div class="container header-inner">
    <a class="brand" href="/">EdgeScraperPro</a>
    <button class="nav-toggle" type="button" aria-expanded="false" aria-controls="primary-nav">Menu</button>
    <nav id="primary-nav" class="site-nav" aria-label="Primary">
      <a href="/" data-nav="home">Home</a>
      <a href="/scrape/" data-nav="scrape">Scrape</a>
      <a href="/sports/" data-nav="sports">Sports</a>
      <a href="/companies/" data-nav="companies">Companies</a>
      <a href="/targets/" data-nav="targets">Target Lists</a>
      <a href="/nda/" data-nav="nda">NDA</a>
    </nav>
  </div></header>

  <main id="main" class="container">
    <h1>M&amp;A Target List Builder</h1>
    <p class="banner">This page preserves the original Target Lists UI.</p>
    <iframe class="app-frame" data-loading="true" title="Target Lists App" src="/targets/app.html" data-src="/targets/app.html" loading="eager"></iframe>
  </main>

  <footer class="site-footer"><div class="container"><small>All processing remains client-side as before.</small></div></footer>
  <script>
    (function(){
      var iframe = document.querySelector('.app-frame');
      if(!iframe) return;
      
      var retryCount = 0;
      var maxRetries = 3;
      var appName = 'M&A Target Lists';
      var retryTimer = null;
      var hasFailed = false;
      
      function logEvent(event, data) {
        if (window.console && console.log) {
          console.log('[IframeLoader]', appName, event, data || '');
        }
        // Send telemetry if available
        if (window.sendTelemetry && typeof window.sendTelemetry === 'function') {
          window.sendTelemetry('iframe_' + event, { app: appName, ...data });
        }
      }
      
      function loadFrame() {
        if (hasFailed) {
          return;
        }
        var src = iframe.getAttribute('data-src') || iframe.getAttribute('src');
        if (!src) {
          logEvent('error', { reason: 'no_src_attribute' });
          return;
        }
        logEvent('retry', { attempt: retryCount + 1, src: src });
        iframe.removeAttribute('src');
        iframe.src = src;
      }

      iframe.addEventListener('load', function(){
        iframe.removeAttribute('data-loading');
        iframe.removeAttribute('data-error');
        logEvent('loaded', { attempts: retryCount + 1 });
        if (retryTimer) {
          clearTimeout(retryTimer);
          retryTimer = null;
        }
        hasFailed = false;
        retryCount = 0;
      });

      iframe.addEventListener('error', function(e){
        logEvent('error', { attempt: retryCount + 1, error: e.message || 'load_failed' });
        if(retryCount < maxRetries) {
          retryCount++;
          if (retryTimer) {
            clearTimeout(retryTimer);
          }
          retryTimer = setTimeout(loadFrame, 1000 * retryCount);
        } else {
          if (retryTimer) {
            clearTimeout(retryTimer);
            retryTimer = null;
          }
          iframe.setAttribute('data-error', 'true');
          iframe.removeAttribute('data-loading');
          logEvent('failed', { totalAttempts: retryCount + 1 });
          hasFailed = true;
        }
      });

      // Initial load tracking
      logEvent('init', { src: iframe.getAttribute('src') });

      window.__iframeLoader = {
        app: appName,
        forceError: function(){ iframe.dispatchEvent(new Event('error')); },
        getRetryCount: function(){ return retryCount; }
      };
    })();
  </script>
  <script src="/js/nav.js" defer></script>
</body>
</html>
