exports.id=907,exports.ids=[907],exports.modules={1628:(a,b)=>{"use strict";function c(a){let{ampFirst:b=!1,hybrid:c=!1,hasQuery:d=!1}=void 0===a?{}:a;return b||c&&d}Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"isInAmpMode",{enumerable:!0,get:function(){return c}})},2768:()=>{},2968:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{default:function(){return p},defaultHead:function(){return l}});let d=c(7020),e=c(3147),f=c(8732),g=e._(c(2015)),h=d._(c(8443)),i=c(7043),j=c(1523),k=c(1628);function l(a){void 0===a&&(a=!1);let b=[(0,f.jsx)("meta",{charSet:"utf-8"},"charset")];return a||b.push((0,f.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")),b}function m(a,b){return"string"==typeof b||"number"==typeof b?a:b.type===g.default.Fragment?a.concat(g.default.Children.toArray(b.props.children).reduce((a,b)=>"string"==typeof b||"number"==typeof b?a:a.concat(b),[])):a.concat(b)}c(2314);let n=["name","httpEquiv","charSet","itemProp"];function o(a,b){let{inAmpMode:c}=b;return a.reduce(m,[]).reverse().concat(l(c).reverse()).filter(function(){let a=new Set,b=new Set,c=new Set,d={};return e=>{let f=!0,g=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){g=!0;let b=e.key.slice(e.key.indexOf("$")+1);a.has(b)?f=!1:a.add(b)}switch(e.type){case"title":case"base":b.has(e.type)?f=!1:b.add(e.type);break;case"meta":for(let a=0,b=n.length;a<b;a++){let b=n[a];if(e.props.hasOwnProperty(b))if("charSet"===b)c.has(b)?f=!1:c.add(b);else{let a=e.props[b],c=d[b]||new Set;("name"!==b||!g)&&c.has(a)?f=!1:(c.add(a),d[b]=c)}}}return f}}()).reverse().map((a,b)=>{let c=a.key||b;return g.default.cloneElement(a,{key:c})})}let p=function(a){let{children:b}=a,c=(0,g.useContext)(i.AmpStateContext),d=(0,g.useContext)(j.HeadManagerContext);return(0,f.jsx)(h.default,{reduceComponentsToState:o,headManager:d,inAmpMode:(0,k.isInAmpMode)(c),children:b})};("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},4254:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>j});var e=c(8732),f=c(8462),g=c(5177),h=c(2015),i=a([f,g]);function j({datasetId:a,templateId:b,customMapping:c,sampleSize:d=50}){let i=(0,h.useRef)(null),{data:j,isLoading:k,error:l}=(0,f.useQuery)({queryKey:["preview",a,b,c,d],queryFn:async()=>{let e=await fetch("/api/preview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({datasetId:a,templateId:b,customMapping:c,sampleSize:d})});if(!e.ok){let a=await e.json();throw Error(a.error?.message||"Failed to load preview")}return e.json()}}),m=(0,g.useVirtualizer)({count:j?.sampleRows.transformed.length||0,getScrollElement:()=>i.current,estimateSize:()=>50});if(k)return(0,e.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,e.jsx)("p",{className:"text-gray-600",children:"Loading preview..."})]})});if(l)return(0,e.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,e.jsx)("h4",{className:"font-semibold text-red-900 mb-2",children:"Preview Error"}),(0,e.jsx)("p",{className:"text-red-800",children:l.message})]});if(!j)return null;let n=j.columns.target.filter(a=>Object.values(j.mapping).includes(a.name));return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,e.jsxs)("div",{className:"bg-blue-50 rounded-lg p-4",children:[(0,e.jsx)("h4",{className:"font-semibold text-blue-900",children:"Dataset"}),(0,e.jsx)("p",{className:"text-blue-800",children:j.dataset.name}),(0,e.jsxs)("p",{className:"text-sm text-blue-700",children:["~",j.dataset.rowsEstimated?.toLocaleString()," rows"]})]}),(0,e.jsxs)("div",{className:"bg-green-50 rounded-lg p-4",children:[(0,e.jsx)("h4",{className:"font-semibold text-green-900",children:"Template"}),(0,e.jsx)("p",{className:"text-green-800",children:j.template.name}),(0,e.jsxs)("p",{className:"text-sm text-green-700",children:["v",j.template.version]})]}),(0,e.jsxs)("div",{className:"bg-purple-50 rounded-lg p-4",children:[(0,e.jsx)("h4",{className:"font-semibold text-purple-900",children:"Mapping Quality"}),(0,e.jsx)("div",{className:"flex items-center space-x-2",children:(0,e.jsxs)("span",{className:`badge ${j.mappingStats.mappingComplete?"badge-success":"badge-warning"}`,children:[j.mappingStats.mappedHeaders,"/",j.mappingStats.totalHeaders," mapped"]})}),(0,e.jsxs)("p",{className:"text-sm text-purple-700",children:[j.mappingStats.requiredFieldsMapped,"/",j.mappingStats.requiredFieldsTotal," required"]})]})]}),(!j.mappingStats.mappingComplete||j.unmappedHeaders.length>0)&&(0,e.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[(0,e.jsx)("h4",{className:"font-semibold text-yellow-900 mb-2",children:"Mapping Warnings"}),(0,e.jsxs)("div",{className:"space-y-2 text-sm",children:[!j.mappingStats.mappingComplete&&(0,e.jsx)("p",{className:"text-yellow-800",children:"• Some required fields are not mapped and may result in incomplete data"}),j.unmappedHeaders.length>0&&(0,e.jsxs)("p",{className:"text-yellow-800",children:["• Unmapped columns: ",j.unmappedHeaders.join(", ")]})]})]}),(0,e.jsxs)("div",{className:"card",children:[(0,e.jsxs)("div",{className:"card-header",children:[(0,e.jsxs)("h3",{children:["Data Preview (",j.sampleRows.transformed.length," sample rows)"]}),(0,e.jsx)("p",{className:"text-sm text-gray-600",children:"Showing transformed data as it will appear in the final export"})]}),(0,e.jsx)("div",{className:"card-body p-0",children:(0,e.jsx)("div",{ref:i,className:"h-96 overflow-auto",children:(0,e.jsxs)("div",{style:{height:`${m.getTotalSize()}px`,width:"100%",position:"relative"},children:[(0,e.jsx)("div",{className:"sticky top-0 z-10 bg-gray-50 border-b",children:(0,e.jsx)("div",{className:"flex",children:n.map(a=>(0,e.jsxs)("div",{className:"flex-1 min-w-32 px-4 py-3 text-sm font-medium text-gray-900 border-r",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("span",{children:a.name}),a.required&&(0,e.jsx)("span",{className:"badge badge-error text-xs",children:"Required"})]}),a.transform&&(0,e.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["Transform: ",a.transform]})]},a.name))})}),m.getVirtualItems().map(a=>{let b=j.sampleRows.transformed[a.index];return(0,e.jsx)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:`${a.size}px`,transform:`translateY(${a.start}px)`},className:`flex ${a.index%2==0?"bg-white":"bg-gray-50"} border-b hover:bg-blue-50`,children:n.map(a=>(0,e.jsx)("div",{className:"flex-1 min-w-32 px-4 py-3 text-sm border-r",children:(0,e.jsx)("div",{className:"truncate",title:b[a.name]?.toString(),children:null!==b[a.name]&&void 0!==b[a.name]?b[a.name].toString():(0,e.jsx)("span",{className:"text-gray-400 italic",children:a.defaultValue||"N/A"})})},a.name))},a.index)})]})})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center",children:[(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:j.sampleRows.transformed.length}),(0,e.jsx)("div",{className:"text-sm text-gray-600",children:"Sample Rows"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:n.length}),(0,e.jsx)("div",{className:"text-sm text-gray-600",children:"Mapped Fields"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:j.mappingStats.requiredFieldsMapped}),(0,e.jsx)("div",{className:"text-sm text-gray-600",children:"Required Fields"})]}),(0,e.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[Math.round(j.mappingStats.mappedHeaders/j.mappingStats.totalHeaders*100),"%"]}),(0,e.jsx)("div",{className:"text-sm text-gray-600",children:"Coverage"})]})]})]})}[f,g]=i.then?(await i)():i,d()}catch(a){d(a)}})},4385:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>i});var e=c(8732),f=c(8462),g=c(2015);c(2768);var h=a([f]);function i({Component:a,pageProps:b}){let[c]=(0,g.useState)(()=>new f.QueryClient({defaultOptions:{queries:{staleTime:3e5,refetchOnWindowFocus:!1}}}));return(0,e.jsx)(f.QueryClientProvider,{client:c,children:(0,e.jsx)(a,{...b})})}f=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})},7043:(a,b,c)=>{"use strict";a.exports=c(3885).vendored.contexts.AmpContext},8443:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"default",{enumerable:!0,get:function(){return f}});let d=c(2015),e=()=>{};function f(a){var b;let{headManager:c,reduceComponentsToState:f}=a;function g(){if(c&&c.mountedInstances){let b=d.Children.toArray(Array.from(c.mountedInstances).filter(Boolean));c.updateHead(f(b,a))}}return null==c||null==(b=c.mountedInstances)||b.add(a.children),g(),e(()=>{var b;return null==c||null==(b=c.mountedInstances)||b.add(a.children),()=>{var b;null==c||null==(b=c.mountedInstances)||b.delete(a.children)}}),e(()=>(c&&(c._pendingUpdate=g),()=>{c&&(c._pendingUpdate=g)})),null}},9788:(a,b,c)=>{a.exports=c(2968)}};